{% set current = item if item is defined else None %}
{% set form_prefix = form_id if form_id is defined else 'investment' %}
{% set select_class = 'w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100' %}
{% set product_select_id = form_prefix ~ '-product-select' %}
{% set action_select_id = form_prefix ~ '-action-select' %}
{% set channel_select_id = form_prefix ~ '-channel-select' %}
<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">日期</label>
    <input
      type="date"
      name="date_value"
      class="{{ select_class }}"
      value="{{ current.date.isoformat() if current and current.date else '' }}"
      required
    />
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">产品</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ product_select_id }}"
        name="product_id"
        class="{{ select_class }}"
        required
      >
        {% for product in products %}
        <option value="{{ product.id }}" {% if current and current.product_id == product.id %}selected{% endif %}>{{ product.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/product_tracker/products/quick_form"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": product_select_id, "field_name": "product_id"} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">动作</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ action_select_id }}"
        name="action_id"
        class="{{ select_class }}"
        required
      >
        {% for action in master_data.action_types %}
        <option value="{{ action.id }}" {% if current and current.action_id == action.id %}selected{% endif %}>{{ action.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/master_data/quick_form/dim_action_type"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": action_select_id, "field_name": "action_id", "include_blank": "false", "blank_label": ""} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">金额</label>
    <input
      type="number"
      step="0.01"
      name="amount"
      class="{{ select_class }}"
      value="{{ '%.2f'|format(current.amount) if current else '' }}"
      required
    />
  </div>
</div>
<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">资金渠道</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ channel_select_id }}"
        name="channel_account_id"
        class="{{ select_class }}"
      >
        <option value="">---</option>
        {% for account in master_data.accounts %}
        <option value="{{ account.id }}" {% if current and current.channel_account_id == account.id %}selected{% endif %}>{{ account.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/master_data/quick_form/dim_account"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": channel_select_id, "field_name": "channel_account_id", "include_blank": "true", "blank_label": "---"} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div class="md:col-span-2">
    <label class="mb-1 block text-sm font-medium text-gray-700">备注</label>
    <input
      type="text"
      name="remark"
      class="{{ select_class }}"
      value="{{ current.remark if current and current.remark else '' }}"
      placeholder="可选"
    />
  </div>
</div>
