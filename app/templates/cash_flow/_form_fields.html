{% set current = item if item is defined else None %}
{% set current = item if item is defined else None %}
{% set form_prefix = form_id if form_id is defined else 'cashflow' %}
{% set select_class = 'w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100' %}
{% set account_select_id = form_prefix ~ '-account-select' %}
{% set category_select_id = form_prefix ~ '-category-select' %}
{% set source_select_id = form_prefix ~ '-source-select' %}
<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">日期</label>
    <input
      type="date"
      name="date_value"
      class="{{ select_class }}"
      value="{{ current.date.isoformat() if current and current.date else '' }}"
      required
    />
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">账户</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ account_select_id }}"
        name="account_id"
        class="{{ select_class }}"
        required
      >
        {% for account in master_data.accounts %}
        <option value="{{ account.id }}" {% if current and current.account_id == account.id %}selected{% endif %}>{{ account.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/master_data/quick_form/dim_account"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": account_select_id, "field_name": "account_id", "include_blank": "false", "blank_label": ""} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">类别</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ category_select_id }}"
        name="category_id"
        class="{{ select_class }}"
      >
        <option value="">---</option>
        {% for category in master_data.categories %}
        <option value="{{ category.id }}" {% if current and current.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/master_data/quick_form/dim_category"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": category_select_id, "field_name": "category_id", "include_blank": "true", "blank_label": "---"} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">收支类型</label>
    <select
      name="flow_type"
      class="{{ select_class }}"
      required
    >
      <option value="收入" {% if current and current.flow_type == '收入' %}selected{% endif %}>收入</option>
      <option value="支出" {% if current and current.flow_type == '支出' %}selected{% endif %}>支出</option>
    </select>
  </div>
</div>
<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">金额</label>
    <input
      type="number"
      step="0.01"
      name="amount"
      class="{{ select_class }}"
      value="{{ '%.2f'|format(current.amount) if current else '' }}"
      required
    />
  </div>
  <div>
    <label class="mb-1 block text-sm font-medium text-gray-700">来源类型</label>
    <div class="flex items-center gap-2">
      <select
        id="{{ source_select_id }}"
        name="source_type_id"
        class="{{ select_class }}"
      >
        <option value="">---</option>
        {% for source in master_data.source_types %}
        <option value="{{ source.id }}" {% if current and current.source_type_id == source.id %}selected{% endif %}>{{ source.name }}</option>
        {% endfor %}
      </select>
      <button
        type="button"
        class="text-sm font-medium text-blue-600 transition hover:text-blue-700"
        hx-get="/master_data/quick_form/dim_source_type"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        hx-vals='{{ {"field_id": source_select_id, "field_name": "source_type_id", "include_blank": "true", "blank_label": "---"} | tojson }}'
      >
        ＋
      </button>
    </div>
  </div>
  <div class="md:col-span-2">
    <label class="mb-1 block text-sm font-medium text-gray-700">备注</label>
    <input
      type="text"
      name="remark"
      class="{{ select_class }}"
      value="{{ current.remark if current and current.remark else '' }}"
      placeholder="可选"
    />
  </div>
</div>
