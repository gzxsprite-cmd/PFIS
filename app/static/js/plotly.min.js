(function () {
  function enqueue(callback) {
    if (window.Plotly) {
      callback();
      return;
    }
    window.__pfisPlotlyQueue = window.__pfisPlotlyQueue || [];
    window.__pfisPlotlyQueue.push(callback);
  }

  window.PFISPlotlyReady = enqueue;

  if (!window.Plotly) {
    var script = document.createElement('script');
    script.src = 'https://cdn.plot.ly/plotly-2.30.0.min.js';
    script.onload = function () {
      if (window.__pfisPlotlyQueue) {
        window.__pfisPlotlyQueue.forEach(function (cb) {
          try {
            cb();
          } catch (err) {
            console.error('Plotly callback error', err);
          }
        });
        window.__pfisPlotlyQueue.length = 0;
      }
    };
    document.head.appendChild(script);
  }
})();
